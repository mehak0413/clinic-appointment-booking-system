<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:insert="~{fragments/head :: commonHead('Prescription History')}"></head>
<body class="bg-gray-100 min-h-screen p-8">
<div class="flex min-h-screen">
  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-lg fixed left-0 top-0 h-full">
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>
  </aside>

  <!-- Main content -->
  <main class="flex-1 ml-64 p-8">
    <div class="max-w-7xl mx-auto">
      <h1 class="text-3xl font-bold mb-6 text-gray-700">Prescription History</h1>
      <div class="overflow-x-auto bg-white shadow-md rounded-lg">
        <table id="historyTable" class="min-w-full border-collapse border border-gray-300">
          <thead class="bg-gray-200 text-gray-700">
            <tr>
              <th class="px-4 py-2 border">Appointment ID</th>
              <th class="px-4 py-2 border">Patient ID</th>
              <th class="px-4 py-2 border">Medication</th>
              <th class="px-4 py-2 border">Dosage</th>
              <th class="px-4 py-2 border">Instructions</th>
              <th class="px-4 py-2 border">Issued At</th>
            </tr>
          </thead>
          <tbody class="text-gray-600"></tbody>
        </table>
      </div>
    </div>
  </main>
</div>

  <!-- Inline JS -->
  <script>
    async function loadHistory() {
      const doctorId = 1; // TODO: replace with logged-in doctor ID dynamically
      const response = await fetch(`/history/doctor/${doctorId}`);
      const tbody = document.querySelector("#historyTable tbody");

      if (!response.ok) {
        tbody.innerHTML = "<tr><td colspan='6' class='text-center py-4'>No access or no history found</td></tr>";
        return;
      }

      const history = await response.json();
      tbody.innerHTML = ""; // Clear existing rows

      history.forEach(h => {
        tbody.innerHTML += `
          <tr class="border-b hover:bg-gray-50">
            <td class="px-4 py-2 border">${h.appointmentId}</td>
            <td class="px-4 py-2 border">${h.patientId}</td>
            <td class="px-4 py-2 border">${h.medication}</td>
            <td class="px-4 py-2 border">${h.dosage}</td>
            <td class="px-4 py-2 border">${h.instructions}</td>
            <td class="px-4 py-2 border">${h.issuedAt}</td>
          </tr>`;
      });
    }

    loadHistory();
  </script>

</body>
</html>
